{% extends 'shared/base_template.html' %}
{% load static %}
{% load poll_extras %}
{% block page_title %}
  بیلان ساختمان ({{ house.name }})
{% endblock page_title %}

{% block main_content %}
{#    <hr/>#}
    <div class="container py-4">
         <div class="row text-md-start">
        <div class="col">
            <a href="{% url 'admin_house_balance_report' %}" class="btn btn-gradient-info py-2 px-3">برگشت به لیست </a>
        </div>
    </div>
         <div class="row row-cols-1 py-3">
      <div class="col">
        <div class="card h-100 shadow-lg">
               <div class="card-footer text-center bg-gradient-success">
            <h5 class="fw-bold shadow_lg text-white mt-2 ">وضعیت کلی ساختمان (    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %})</h5>
          </div>
          <div class="card-body py-1">
               <div class="row mt-2">
                  <div class="col"  style="font-size: 14px; font-weight: 500">موجودی صندوق</div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                      {{ balance |three_digit_currency }}  تومان  
                      </p>
                  </div>
              </div>

          
               <div class="row">
                  <div class="col"  style="font-size: 14px; font-weight: 500">شارژ پرداخت نشده</div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                          {% if total_charge_unpaid %}
                          	      {{ total_charge_unpaid |three_digit_currency }}  تومان 
                              {% else %}
                              0
                          {% endif %} 
                
                      </p>
                  </div>
              </div>
          </div>
       
        </div>
      </div>
         </div>
    <div class="container py-4">
        <form method="get">
        <div class="row g-3">
            <div class="col-12 col-xl-3 col-md-3">
                <input type="text"
                       name="start_date"
                       data-jdp
                       data-jdp-only-date
                       class="form-control"
                       placeholder="شروع تاریخ"
                       value="{{ start_date|default_if_none:'' }}">                              
            </div>
            <div class="col-12 col-xl-3 col-md-3">
                <input type="text"
                   name="end_date"
                   data-jdp
                   data-jdp-only-date
                   class="form-control"
                   placeholder="پایان تاریخ"
                   value="{{ end_date|default_if_none:'' }}">
            </div>
            <div class="col-12 col-xl-3 col-md-3">
                <select class="form-control form-control-sm" name="bank">
        <option value="">همه بانک‌ها</option>
        {% for b in banks %}
            <option value="{{ b.id }}"
                {% if bank_id == b.id|stringformat:"s" %}selected{% endif %}>
                {{ b.bank_name }}
            </option>
        {% endfor %}
    </select>
            </div>
            <div class="col-12 col-xl-3 col-md-3 d-flex gap-1">
                    <button class="btn btn-gradient-primary" type="submit">اعمال فیلتر</button>
                    <button type="button"
                        class="btn btn-gradient-danger px-4"
                        onclick="clearFilters()">
                    حذف فیلتر
                </button>
            </div>
        </div>
</form>
    </div>
     
        <div class="row py-3">
      <div class="col-sm-6 mb-3 mb-sm-0">
        <div class="card text-center">
          <div class="card-body g-2">
            <h6 class="card-title">مجموع درآمدهای دریافت نشده</h6>
                      <p class="card-text text-muted py-2">
    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %}
</p>
            <p class="card-text text-success fw-bold">
                {% if total_incomes_exclude_unpaid %}
                {{ total_incomes_exclude_unpaid | three_digit_currency }} تومان 
                    {% else %}
                    0
                {% endif %} 
            </p>
            <a href="" class="btn btn-primary px-3 py-2 mt-3">مشاهده جزئیات</a>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card text-center shadow_lg">
             <div class="card-body">
            <h6 class="card-title">مجموع هزینه های پرداخت نشده</h6>
          <p class="card-text text-muted py-2">
    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %}
</p>
            <p class="card-text text-danger fw-bold">
                {% if total_expenses_exclude_unpaid %}
                {{ total_expenses_exclude_unpaid | three_digit_currency }}  تومان 
                {% else %}
                0
                {% endif %}
            </p>
            <a href="" class="btn btn-primary px-3 py-2 mt-3">مشاهده جزئیات</a>
          </div>
        </div>
      </div>
    </div>
    
        <div class="row row-cols-1 row-cols-md-2 py-3">
      <div class="col">
        <div class="card h-100 shadow-lg">
               <div class="card-footer text-center bg-gradient-success">
            <small class="fw-bold shadow_lg" style="font-size: 15px">جمع کل دارائی ها : {{ total_assets|three_digit_currency }} تومان</small>
                   
          </div>
          <div class="card-body">
               <div class="row mb-2">
                  <div class="col"  style="font-size: 14px">
                      جمع درآمدها
                                 <p class="card-text text-muted py-2 text-small">
    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %}
</p>
                  </div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                          {% if total_incomes %}
                          	  {{ total_incomes |three_digit_currency }}  تومان  
                              {% else %}
                              0
                          {% endif %} 
                    
                      </p>
                  </div>
              </div>
          
               <div class="row">
                  <div class="col"  style="font-size: 14px">
                      جمع اسناد دریافتی
                                <p class="card-text text-muted py-2 text-small">
    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %}
</p>
                  </div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                          {% if total_receive_money %}
                          	    {{ total_receive_money |three_digit_currency }}  تومان  
                             {% else %}
                              0
                          {% endif %}  
                      </p>
                  </div>
              </div>
          </div>
       
        </div>
      </div>
      <div class="col">
        <div class="card h-100 shadow_lg">
             <div class="card-footer bg-gradient-danger text-center">
            <small class="fw-bold shadow-lg" style="font-size: 15px">جمع کل بدهی ها : {{ total_debts|three_digit_currency }}  تومان </small>
          </div>
          <div class="card-body">
{#            <h5 class="card-title">Card title</h5>#}
                 <div class="row mb-2" style="font-size: 14px">
                  <div class="col">
                      جمع کل هزینه ها
                                <p class="card-text text-muted py-2 text-small ">
    {% if not start_date %}
        از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
    {% else %}
        از تاریخ {{ start_date }} تا {{ end_date }}
    {% endif %}
</p>
                  </div>
                  <div class="col text-start">
                      <p class="text-lg fw-bold" style="font-size: 14px">
                          {% if total_expenses %}
                          	{{ total_expenses |three_digit_currency }}  تومان 
                              {% else %}
                              0
                          {% endif %} 
                      
                          
                      </p>
                  </div>
              </div>
                   <div class="row">
                  <div class="col" style="font-size: 14px">
                      جمع اسناد پرداختی
                               <p class="card-text text-muted py-2 text-small">
                                {% if not start_date %}
                                    از تاریخ {{ house.created_at|show_jalali_admin }}    تا امروز 
                                {% else %}
                                    از تاریخ {{ start_date }} تا {{ end_date }}
                                {% endif %}
                            </p>
                  </div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                          {% if total_pay_money %}
                               {{ total_pay_money |three_digit_currency }}  تومان
                              {% else %}
                          	0
                          {% endif %} 
                      </p>
                     
                  </div>
              </div>
          </div>
         
        </div>
      </div>
    </div>
         <div class="row row-cols-1">
      <div class="col">
       <div class="card h-100 shadow-lg py-1">
          <div class="card-body py-1">
               <div class="row mt-2">
                  <div class="col"  style="font-size: 14px">جمع کل </div>
                  <div class="col text-start">
                      <p class="fw-bold" style="font-size: 14px">
                          
                      {{ total_amount_assets_debts |three_digit_currency }}  تومان  
                      </p>
                  </div>
              </div>
    
          </div>
       
        </div>
      </div>
         </div>
      
    </div>
    <script type="text/javascript" src="https://unpkg.com/@majidh1/jalalidatepicker/dist/jalalidatepicker.min.js"></script>
<script>
function clearFilters() {
    document.querySelector('input[name=start_date]').value = '';
    document.querySelector('input[name=end_date]').value = '';
    document.querySelector('select[name=bank]').value = '';
    window.location = window.location.pathname;
}
</script>
{% endblock %}








