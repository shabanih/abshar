{% extends 'middleShared/base_template.html' %}
{% load static %}
{% load poll_extras %}

{% block page_title %}
مدیریت پیامک ها
{% endblock page_title %}

{% block main_content %}
<div class="container mt-3">
<div class="card">
<div class="text-muted small p-2">
    <strong class="mb-3 py-3">شرایط تأیید پیامک:</strong>
    <ul class="pe-3 mt-2">
        <li><p class="m-0">عدم تأیید پیامک‌های مغایر با قوانین کشور ایران</p></li>
        <li><p class="m-0">عدم تأیید پیامک‌های حاوی شماره کارت بانکی</p></li>
        <li><p class="m-0">عدم تأیید پیامک‌های غیرمرتبط با امور ساختمان</p></li>
        <li> <p class="m-0"> عدم تأیید در صورت وجود لینک در متن پیامک</p> </li>
    </ul>
</div>


</div>
    <form id="smsForm" action="" method="post" novalidate>
        {% csrf_token %}
        <div class="row">
            <div class="col-12 col-lg-8">
                {{ form.subject.label_tag }}
                {{ form.subject }}
                {{ form.subject.errors }}
            </div>
            <div class="col-12 col-lg-4 py-2">
                {{ form.is_active.label_tag }}
                {{ form.is_active }}
                {{ form.is_active.errors }}
            </div>
            <div class="col-12">
                <textarea
                    id="sms_message"
                    name="message"
                    class="form-control"
                    rows="4"
                    placeholder="متن پیامک را وارد کنید..."
                ></textarea>
                
            <div class="mt-2 text-muted small" id="smsInfo">
                 1/ <span class="remaining">70</span>
            </div>
            </div>


                  {% if form.instance.id %}
        	<div class=" col-12 pt-4 text-start">
                 <button type="submit" class="btn btn-gradient-success">ذخیره پیامک</button>
              </div>
             {% else %}
             <div class="col-12  pt-4 text-start">
                 <button type="submit" class="btn btn-gradient-success">ثبت پیامک</button>
              </div>
        {% endif %}

        </div>


    </form>

    <div class="container p-0 mt-4">
        <div class="row mt-2">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="text-center">
                        <tr>
                            <th>#</th>
{#                            <th>ایجاد کننده</th>#}
                            <th>عنوان </th>
                            <th>متن پیامک </th>
                            <th>تاریخ ایجاد</th>
                            <th>فعال/غیرفعال</th>
                            <th>وضعیت</th>
                            <th>دستورات</th>
                        </tr>
                    </thead>
                    {% if all_sms %}
                        {% for sms in all_sms %}
                        <tbody class="text-center">
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ sms.subject }}</td>
                                <td class="col-4">{{ sms.message }}</td>

                                <td>{{ sms.created_at|show_jalali}}</td>
                                  <td class="p-0">
                                   {% if sms.is_active == True %}
                                    <button class="btn btn-primary bg-info p-2">فعال</button>
                                       {% else %}
                                       <button class="btn btn-danger p-2">غیر فعال</button>
                                   {% endif %}
                                </td>
                                       <td class="p-0 m-0">
                                   {% if sms.is_approved == True %}
                                    <button class="btn btn-primary bg-success p-2">تایید شده توسط ادمین/در انتظار ارسال</button>
                                       {% else %}
                                       <button class="btn btn-warning p-2">در انتظار تایید ادمین</button>
                                   {% endif %}
                                </td>
                            {% if sms.is_approved == True %}
                               <td class="col-1 p-0">
{#                                   <a href="{% url 'middle_edit_sms' sms.id %}" class="btn btn-primary p-1">#}
{#                              <i class="mdi mdi-lead-pencil" aria-hidden="true"></i></a>#}
{#                                     <a href="{% url 'middle_delete_sms' sms.id %}" class="btn btn-gradient-danger p-1"#}
{#                                        onclick="return confirmDeleteWithSweetAlert(event)">#}
{#                                              <i class="mdi mdi-delete" aria-hidden="true"></i>#}
{#                                            </a>#}
                           <a href="{% url 'middle_show_send_sms_form' sms.id %}" class="btn btn-gradient-primary p-2">
                                 ارسال پیامک
{#                                   <i class="fas fa-sms"></i>#}
                                </a>

                            </td>
                                {% else %}
                                      <td class="col-1 p-0">
                                   <a href="{% url 'middle_edit_sms' sms.id %}" class="btn btn-primary p-1">
                              <i class="mdi mdi-lead-pencil" aria-hidden="true"></i></a>
                                     <a href="{% url 'middle_delete_sms' sms.id %}" class="btn btn-gradient-danger p-1"
                                        onclick="return confirmDeleteWithSweetAlert(event)">
                                              <i class="mdi mdi-delete" aria-hidden="true"></i>
                                            </a>
{#                             <a href="{% url 'middle_show_send_sms_form' sms.id %}" class="btn btn-gradient-success p-1"#}
{#                                   data-bs-toggle="tooltip" title="ارسال پیامک">#}
{#                                   <i class="fas fa-sms"></i>#}
{#                                </a>#}

                            </td>
                          {% endif %}
                            </tr>
                        </tbody>
                        {% endfor %}
                    {% else %}
                        <tbody>
                            <tr>
                                <td colspan="11" class="text-center">هیچ پیامکی ثبت نشده است.</td>
                            </tr>
                        </tbody>
                    {% endif %}
                </table>
            </div>
        </div>
    </div>
</div>
<script>

</script>

{% endblock %}





